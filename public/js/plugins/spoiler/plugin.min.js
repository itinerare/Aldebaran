tinymce.PluginManager.add("spoiler",function(a,b){function c(){var b=a.selection,c=b.getNode();c&&(a.undoManager.transact(function(){var a=b.getContent();a||(a="Spoiler text."),b.setContent("<div class=\"spoiler\"><div class=\"spoiler-toggle\">"+e+" </div><div class=\"spoiler-text\">"+a+"</div></div>")}),a.nodeChanged())}function d(){var b=a.selection,c=b.getNode();c&&"spoiler"==c.className&&(a.undoManager.transact(function(){var a=document.createElement("p");a.innerHTML=c.getElementsByClassName("spoiler-text")[0].innerHTML,c.parentNode.replaceChild(a,c)}),a.nodeChanged())}var f=a.$;a.contentCSS.push(b+"/css/spoiler.css");var e=a.getParam("spoiler_caption","Spoiler!");5==tinymce.majorVersion&&(a.ui.registry.addIcon("addspoiler","<svg width=\"24\" height=\"24\"><use xlink:href=\""+b+"/img/spoiler_icons.svg#addspoiler\"></use></svg>"),a.ui.registry.addIcon("removespoiler","<svg width=\"24\" height=\"24\"><use xlink:href=\""+b+"/img/spoiler_icons.svg#removespoiler\"></use></svg>")),a.on("PreProcess",function(a){f("div[class*=\"spoiler\"]",a.node).each(function(a,b){b.hasAttribute("contenteditable")&&b.removeAttribute("contentEditable")})}),a.on("SetContent",function(){f("div[class*=\"spoiler\"]").each(function(a,b){if(!b.hasAttribute("contenteditable")){var c=f(b);c.hasClass("spoiler")?b.contentEditable=!1:c.hasClass("spoiler-text")&&(b.contentEditable=!0)}})}),4==tinymce.majorVersion?(a.addButton("spoiler-add",{tooltip:"Add spoiler",image:b+"/img/eye-blocked.png",onclick:c}),a.addMenuItem("spoiler-add",{text:"Add spoiler",context:"format",onclick:c}),a.addButton("spoiler-remove",{tooltip:"Remove spoiler",image:b+"/img/eye-plus.png",onclick:d}),a.addMenuItem("spoiler-remove",{text:"Remove spoiler",context:"format",onclick:d})):(a.ui.registry.addButton("spoiler-add",{tooltip:"Add spoiler",icon:"addspoiler",onAction:c}),a.ui.registry.addMenuItem("spoiler-add",{text:"Add spoiler",context:"format",onAction:c}),a.ui.registry.addButton("spoiler-remove",{tooltip:"Remove spoiler",icon:"removespoiler",onAction:d}),a.ui.registry.addMenuItem("spoiler-remove",{text:"Remove spoiler",context:"format",onAction:d}))});